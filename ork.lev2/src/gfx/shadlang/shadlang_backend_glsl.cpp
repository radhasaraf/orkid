////////////////////////////////////////////////////////////////
// Orkid Media Engine
// Copyright 1996-2023, Michael T. Mayers.
// Distributed under the MIT License.
// see license-mit.txt in the root of the repo, and/or https://opensource.org/license/mit/
////////////////////////////////////////////////////////////////

#include <ork/lev2/gfx/shadlang.h>

namespace ork::lev2::shadlang {
/////////////////////////////////////////////////////////////////////////////////////////////////

struct GL4SLBackend {
  ////////////////////////////////////////////////////////////////
  void _visit(SHAST::astnode_ptr_t node) {
    _node_stack.push(node);
    ///////////////////////////////////////////////
    // pre-visit
    ///////////////////////////////////////////////
    ///////////////////////////////////////////////
    for (auto c : node->_children) {
      _visit(c);
    }
    ///////////////////////////////////////////////
    // post-visit
    ///////////////////////////////////////////////
    ///////////////////////////////////////////////
    _node_stack.pop();
  }
  ////////////////////////////////////////////////////////////////
  std::string generate(SHAST::translationunit_ptr_t top) {
    _visit(top);
  }
  ////////////////////////////////////////////////////////////////
  std::string _outstr;
  std::stack<SHAST::astnode_ptr_t> _node_stack;
};
using gl4slbackend_ptr_t = std::shared_ptr<GL4SLBackend>;

/////////////////////////////////////////////////////////////////////////////////////////////////

std::string toGL4SL(SHAST::translationunit_ptr_t top) {
  auto backend = std::make_shared<GL4SLBackend>();
  backend->generate(top);
  return backend->_outstr;
}

/////////////////////////////////////////////////////////////////////////////////////////////////
} // namespace ork::lev2::shadlang
